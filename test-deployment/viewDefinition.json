{
  "$schema": "https://schema.management.azure.com/schemas/viewdefinition/0.0.1-preview/ViewDefinition.json#",
  "contentVersion": "1.0.0.0",
  "views": [
    {
      "kind": "Overview",
      "properties": {
        "header": "Virtual Machine Overview",
        "description": "Comprehensive view of your production-ready VM deployment with monitoring, cost optimization, high availability, and disaster recovery features.",
        "commands": [
          {
            "kind": "OpenBladeCommand",
            "displayName": "Manage VM",
            "blade": {
              "name": "VirtualMachineMenuBlade",
              "extension": "Microsoft_Azure_Compute",
              "parameters": {
                "id": "[resourceId('Microsoft.Compute/virtualMachines', parameters('vmName'))]"
              },
              "inContextPane": true
            }
          }
        ]
      }
    },
    {
      "kind": "Metrics",
      "properties": {
        "header": "Performance Metrics",
        "description": "Real-time VM performance monitoring with CPU, memory, disk, and network metrics.",
        "displayName": "Performance",
        "charts": [
          {
            "displayName": "CPU Utilization",
            "chartType": "Line",
            "metrics": [
              {
                "name": "Percentage CPU",
                "resourceType": "Microsoft.Compute/virtualMachines",
                "aggregationType": "Average",
                "namespace": "Microsoft.Compute/virtualMachines"
              }
            ]
          },
          {
            "displayName": "Disk Operations",
            "chartType": "Line",
            "metrics": [
              {
                "name": "Disk Read Bytes",
                "resourceType": "Microsoft.Compute/virtualMachines",
                "aggregationType": "Total",
                "namespace": "Microsoft.Compute/virtualMachines"
              },
              {
                "name": "Disk Write Bytes",
                "resourceType": "Microsoft.Compute/virtualMachines",
                "aggregationType": "Total",
                "namespace": "Microsoft.Compute/virtualMachines"
              }
            ]
          },
          {
            "displayName": "Network Traffic",
            "chartType": "Line",
            "metrics": [
              {
                "name": "Network In Total",
                "resourceType": "Microsoft.Compute/virtualMachines",
                "aggregationType": "Total",
                "namespace": "Microsoft.Compute/virtualMachines"
              },
              {
                "name": "Network Out Total",
                "resourceType": "Microsoft.Compute/virtualMachines",
                "aggregationType": "Total",
                "namespace": "Microsoft.Compute/virtualMachines"
              }
            ]
          }
        ]
      }
    },
    {
      "kind": "CustomResources",
      "properties": {
        "header": "Monitoring & Observability",
        "description": "Azure Monitor integration with Log Analytics, Application Insights, and alerting.",
        "displayName": "Monitoring",
        "commands": [
          {
            "kind": "OpenBladeCommand",
            "displayName": "Open Log Analytics",
            "blade": {
              "name": "LogsBlade",
              "extension": "Microsoft_Azure_Monitoring",
              "parameters": {
                "resourceId": "[reference('logAnalyticsWorkspace').id]"
              },
              "inContextPane": false
            }
          },
          {
            "kind": "OpenBladeCommand",
            "displayName": "View Application Insights",
            "blade": {
              "name": "ApplicationInsightsBlade",
              "extension": "AppInsightsExtension",
              "parameters": {
                "resourceId": "[reference('applicationInsights').id]"
              },
              "inContextPane": false
            }
          }
        ],
        "columns": [
          {
            "key": "name",
            "displayName": "Resource Name"
          },
          {
            "key": "type",
            "displayName": "Resource Type"
          },
          {
            "key": "status",
            "displayName": "Status"
          }
        ],
        "resources": [
          {
            "type": "Microsoft.OperationalInsights/workspaces",
            "name": "[parameters('logAnalyticsWorkspaceName')]"
          },
          {
            "type": "Microsoft.Insights/components",
            "name": "[concat(parameters('vmName'), '-ai')]"
          },
          {
            "type": "Microsoft.Insights/actionGroups",
            "name": "[concat(parameters('vmName'), '-ag')]"
          },
          {
            "type": "Microsoft.Insights/metricAlerts",
            "name": "[concat(parameters('vmName'), '-cpu-alert')]"
          }
        ]
      }
    },
    {
      "kind": "CustomResources",
      "properties": {
        "header": "Cost Optimization",
        "description": "Budget tracking, cost analysis, and right-sizing recommendations.",
        "displayName": "Cost Management",
        "commands": [
          {
            "kind": "OpenBladeCommand",
            "displayName": "View Cost Analysis",
            "blade": {
              "name": "CostAnalysisBlade",
              "extension": "Microsoft_Azure_CostManagement",
              "parameters": {
                "scope": "[resourceGroup().id]"
              },
              "inContextPane": false
            }
          }
        ],
        "columns": [
          {
            "key": "metric",
            "displayName": "Metric"
          },
          {
            "key": "value",
            "displayName": "Value"
          },
          {
            "key": "status",
            "displayName": "Status"
          }
        ],
        "resources": [
          {
            "type": "Microsoft.Consumption/budgets",
            "name": "[concat(parameters('vmName'), '-budget')]"
          }
        ]
      }
    },
    {
      "kind": "CustomResources",
      "properties": {
        "header": "High Availability & Disaster Recovery",
        "description": "Availability configuration, backup status, and disaster recovery readiness.",
        "displayName": "Resilience",
        "commands": [
          {
            "kind": "OpenBladeCommand",
            "displayName": "Manage Backups",
            "blade": {
              "name": "RecoveryServicesVaultBlade",
              "extension": "Microsoft_Azure_RecoveryServices",
              "parameters": {
                "resourceId": "[reference('recoveryServicesVault').id]"
              },
              "inContextPane": false
            }
          }
        ],
        "columns": [
          {
            "key": "component",
            "displayName": "Component"
          },
          {
            "key": "configuration",
            "displayName": "Configuration"
          },
          {
            "key": "status",
            "displayName": "Status"
          }
        ],
        "resources": [
          {
            "type": "Microsoft.Compute/availabilitySets",
            "name": "[concat(parameters('vmName'), '-avset')]"
          },
          {
            "type": "Microsoft.RecoveryServices/vaults",
            "name": "[concat(parameters('vmName'), '-rsv')]"
          }
        ]
      }
    },
    {
      "kind": "Properties",
      "properties": {
        "header": "Deployment Outputs",
        "description": "Key information and connection details from the deployment.",
        "displayName": "Outputs",
        "columns": [
          {
            "key": "name",
            "displayName": "Output Name"
          },
          {
            "key": "value",
            "displayName": "Value"
          },
          {
            "key": "type",
            "displayName": "Type"
          }
        ],
        "rows": [
          {
            "name": "VM Resource ID",
            "value": "[reference('virtualMachine').vmId]",
            "type": "string"
          },
          {
            "name": "Public IP Address",
            "value": "[reference('publicIpAddress').ipAddress]",
            "type": "string"
          },
          {
            "name": "SSH Command",
            "value": "[concat('ssh ', parameters('adminUsername'), '@', reference('publicIpAddress').ipAddress)]",
            "type": "string"
          },
          {
            "name": "Monitoring Status",
            "value": "[if(parameters('enableMonitoring'), 'Enabled', 'Disabled')]",
            "type": "string"
          },
          {
            "name": "High Availability",
            "value": "[parameters('availabilityOption')]",
            "type": "string"
          },
          {
            "name": "Backup Enabled",
            "value": "[if(parameters('enableBackup'), 'Yes', 'No')]",
            "type": "string"
          },
          {
            "name": "Resilience Tier",
            "value": "[reference('resilienceScore').tier]",
            "type": "string"
          }
        ]
      }
    }
  ]
}
