{{!-- Load Balancer ARM Template Outputs --}}
{{!-- Provides information about deployed load balancer resources --}}

{{#if haConfig.loadBalancer.enabled}}
  "loadBalancerName": {
    "type": "string",
    "value": "[variables('loadBalancerName')]",
    "metadata": {
      "description": "Name of the deployed load balancer"
    }
  },
  "loadBalancerResourceId": {
    "type": "string",
    "value": "[resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName'))]",
    "metadata": {
      "description": "Resource ID of the deployed load balancer"
    }
  },
  {{#equal haConfig.loadBalancer.type "public"}}
  "publicIPAddress": {
    "type": "string",
    "value": "[reference(resourceId('Microsoft.Network/publicIPAddresses', variables('publicIPName'))).ipAddress]",
    "metadata": {
      "description": "Public IP address of the load balancer"
    }
  },
  "publicIPFqdn": {
    "type": "string",
    "value": "[reference(resourceId('Microsoft.Network/publicIPAddresses', variables('publicIPName'))).dnsSettings.fqdn]",
    "metadata": {
      "description": "Fully qualified domain name of the public IP"
    }
  },
  {{/equal}}
  "frontendIPConfiguration": {
    "type": "string",
    "value": "[reference(resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName'))).frontendIPConfigurations[0].properties.{{#equal haConfig.loadBalancer.type 'public'}}publicIPAddress.id{{else}}privateIPAddress{{/equal}}]",
    "metadata": {
      "description": "Frontend IP configuration of the load balancer"
    }
  },
  "backendPools": {
    "type": "array",
    "value": "[reference(resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName'))).backendAddressPools]",
    "metadata": {
      "description": "Backend address pools of the load balancer"
    }
  },
  "healthProbes": {
    "type": "array",
    "value": "[reference(resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName'))).probes]",
    "metadata": {
      "description": "Health probes configured on the load balancer"
    }
  },
  "loadBalancingRules": {
    "type": "array",
    "value": "[reference(resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName'))).loadBalancingRules]",
    "metadata": {
      "description": "Load balancing rules configured on the load balancer"
    }
  },
{{/if}}
{{#if haConfig.vmss.enabled}}
  "vmssName": {
    "type": "string",
    "value": "[variables('vmssName')]",
    "metadata": {
      "description": "Name of the deployed VMSS"
    }
  },
  "vmssResourceId": {
    "type": "string",
    "value": "[resourceId('Microsoft.Compute/virtualMachineScaleSets', variables('vmssName'))]",
    "metadata": {
      "description": "Resource ID of the deployed VMSS"
    }
  },
  "vmssInstanceCount": {
    "type": "int",
    "value": "[reference(resourceId('Microsoft.Compute/virtualMachineScaleSets', variables('vmssName'))).sku.capacity]",
    "metadata": {
      "description": "Current instance count of the VMSS"
    }
  },
  {{#if haConfig.vmss.zones}}
  "vmssZones": {
    "type": "array",
    "value": {{{json haConfig.vmss.zones}}},
    "metadata": {
      "description": "Availability zones where VMSS instances are deployed"
    }
  },
  {{/if}}
  {{#if haConfig.vmss.autoscale.enabled}}
  "autoscaleSettingsName": {
    "type": "string",
    "value": "[variables('autoscaleSettingsName')]",
    "metadata": {
      "description": "Name of the autoscale settings"
    }
  },
  "autoscaleSettingsResourceId": {
    "type": "string",
    "value": "[resourceId('Microsoft.Insights/autoscalesettings', variables('autoscaleSettingsName'))]",
    "metadata": {
      "description": "Resource ID of the autoscale settings"
    }
  },
  {{/if}}
{{/if}}